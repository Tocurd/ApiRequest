var ApiRequest=function(){var g,h,i,j,k,b=function(a,b){this.ApiRequestList=a,this.AllOption=b},e={name:{apiName:"api-name",apiParamName:"api-param-name"},event:{click:"clickSubmit"}};return b.prototype.push=function(a,b){var c,d,e;return this.SelectApi=uriGet(this.ApiRequestList,a),0==this.SelectApi?j(!1,"未能找到定义好的API",{}):(c=i(a,b,this.SelectApi),d=h(c,this.SelectApi.params),d.length>0?j(!1,d[0].message,d,"rule_error"):k(b)&&0==b.autoCommit?(e=this.SelectApi,j(!0,"",{api:e,params:c},"ready")):this.commit(this.SelectApi,c))},b.prototype.commit=function(a,b){var c=$.Deferred();return g({url:(k(this.AllOption)&&k(this.AllOption.url)?this.AllOption.url:"")+a.url,data:b,type:k(a.type)?a.type:"POST",dataType:k(a.dataType)?a.dataType:"JSON",timeOut:k(a.timeOut)?a.timeOut:5e3,promise:c}),c},g=function(a){$.ajax({url:a.url,data:a.data,cache:!1,type:a.type,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:a.dataType,timeOut:a.timeOut,content:window,success:function(b){b.state?a.promise.resolve(b):k(b.message)?a.promise.reject({message:"请求出现异常，接口服务器尚未反馈错误信息，请稍候再试！"}):a.promise.reject({message:b.message})},error:function(b){try{var c=JSON.parse(b.responseText);a.promise.reject({message:c.message})}catch(d){a.promise.reject({message:"请求出现异常，服务器繁忙或出现问题无法处理您的请求，请稍候再试！"})}},complete:function(){isRequest=!0}})},b.prototype.success=function(a){setTimeout(function(){""==a||"undefined"==typeof a?window.location.reload():window.location.href=a},isNaN(a)?1e3:a)},h=function(a,b){var c={header:"您输入的",rule:{min:"不能少于",max:"不能大于",nullText:"不能为空",error:"规则不正确"},sum:"位字符",footer:""},d=[];return $.each(a,function(e,f){var g,h,j;if("uriGet"!=e)return g=b[e],f=a[e],h=c.header+g.name,j=f.length,k(g)&&k(g["name"])?(k(g.is_null)&&1==g.is_null&&0==j?d.push({message:h+c.rule.nullText,data:g.other}):k(g.min)&&j<g.min?d.push({message:h+c.rule.min+g.min+c.sum,data:g.other}):k(g.max)&&j>g.max?d.push({message:h+c.rule.max+g.max+c.sum,data:g.other}):k(g.is_number)&&1==g.is_number&&(!isNaN(b[e])||value<g.number_min||value>g.number_max)&&d.push({message:h+c.rule.error,data:g.other}),void 0):!1}),d},i=function(a,b){var c=e.name.apiParamName,d=k(b)&&k(b.target)?b.target:"["+e.name.apiName+"='"+a+"']",f={};return $(d+" ["+c+"]").each(function(a,b){f[$(b).attr(c)]=$(b).val()}),f},j=function(a,b,c,d){return then=function(e,f){var g={message:b,data:c,code:d};a?"function"==typeof e&&e(g):"function"==typeof f&&f(g)},this},k=function(a){return"undefined"!=typeof a},uriGet=function(a,b){var c=a;return b=b.split("/"),$.each(b,function(a,b){c=c[b]}),"undefined"==typeof c?!1:c},b}(jQuery);